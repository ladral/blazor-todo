@page "/"
@inherits Fluxor.Blazor.Web.Components.FluxorComponent
@using Fluxor
@using Bunit.Extensions
@using blazor_wasm_todo.Store

@inject IDispatcher Dispatcher
@inject Blazored.LocalStorage.ILocalStorageService localStorage;

<section class="hero is-primary">
  <div class="hero-body">
    <div class="container">
      <h1 class="title">
        TODO List
      </h1>
      <h2 class="subtitle">
        This is a blazor project to manage your tasks.
      </h2>
    </div>
  </div>
</section>

<div class="columns">
  <div class="column">
    <button @onclick="addTodo" class="button">Add</button>    
  </div>
  <div class="column">
    Second column
  </div>
</div>


 @if (TodoItemsState.Value.TodoItems != null)
 {
   @foreach (var todo in TodoItemsState.Value.TodoItems)
   {
     <TodoCard Title=@todo.title TodoNumber=@todo.id onRemoveTodo=@removeTodo/>
   }
 }   


@code {

  [Inject]
  private IState<TodoItemsState> TodoItemsState { get; set; }
  
  private List<Todo> todoItems;
  const string StorageKey = "todoItems";

  protected override async Task OnInitializedAsync()
  {
    Dispatcher.Dispatch(new LoadFromDB());
  }

  async Task addTodo()
  {
    var nextTodoItemId = TodoItemsState.Value.IndexCounter + 1;
    var newTodoItem = new Todo(nextTodoItemId, "Einkaufen");
    Dispatcher.Dispatch(new AddTodo(newTodoItem));
    Dispatcher.Dispatch(new PersistToDB(TodoItemsState.Value));
  }
  
  async Task removeTodo(int id)
  {
    Dispatcher.Dispatch(new RemoveTodo(id));
    Dispatcher.Dispatch(new PersistToDB(TodoItemsState.Value));
  }

}