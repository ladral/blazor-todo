@page "/"
@inherits Fluxor.Blazor.Web.Components.FluxorComponent
@using Fluxor
@using blazor_wasm_todo.Store

@inject IDispatcher Dispatcher

<section class="hero is-primary">
  <div class="hero-body">
    <div class="container">
      <h1 class="title">
        TODO List
      </h1>
      <h2 class="subtitle">
        This is a blazor project to manage your tasks.
      </h2>
    </div>
  </div>
</section>

<TodoForm addTodoCallback="@addTodo"></TodoForm>

 @if (TodoItemsState.Value.TodoItems != null)
 {
   @foreach (var todo in TodoItemsState.Value.TodoItems)
   {
     <TodoCard Title=@todo.title TodoNumber=@todo.id onRemoveTodo=@removeTodo/>
   }
 }

@code {

  [Inject]
  private IState<TodoItemsState> TodoItemsState { get; init; }

  protected override async Task OnInitializedAsync()
  {
    Dispatcher.Dispatch(new LoadFromStorageAction());
  }

  async Task addTodo(string title)
  {
    Dispatcher.Dispatch(new SaveTodoAction(new Todo(0, title)));
  }
  
  async Task removeTodo(int id)
  {
    Dispatcher.Dispatch(new DeleteTodoAction(id));
  }

}